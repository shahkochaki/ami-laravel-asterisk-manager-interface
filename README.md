# AMI - Laravel Asterisk Manager Interface

<div align="center">
  
![AMI Logo](https://raw.githubusercontent.com/shahkochaki/ami-laravel-asterisk-manager-interface/main/logo.png)

[![Latest Version on Packagist](https://img.shields.io/packagist/v/shahkochaki/ami-laravel-asterisk-manager-interface.svg?style=flat-square)](https://packagist.org/packages/shahkochaki/ami-laravel-asterisk-manager-interface)
[![Total Downloads](https://img.shields.io/packagist/dt/shahkochaki/ami-laravel-asterisk-manager-interface.svg?style=flat-square)](https://packagist.org/packages/shahkochaki/ami-laravel-asterisk-manager-interface)
[![License](https://img.shields.io/packagist/l/shahkochaki/ami-laravel-asterisk-manager-interface.svg?style=flat-square)](https://packagist.org/packages/shahkochaki/ami-laravel-asterisk-manager-interface)
[![PHP Version](https://img.shields.io/packagist/php-v/shahkochaki/ami-laravel-asterisk-manager-interface.svg?style=flat-square)](https://packagist.org/packages/shahkochaki/ami-laravel-asterisk-manager-interface)

</div>

A powerful and easy-to-use Laravel package for connecting to VOIP servers on the Issabel and Asterisk platform via Asterisk Manager Interface (AMI).

## ‚ú® Key Features

- üîó **Easy AMI Connection** - Simplified connection management
- üì± **SMS Messaging** - Send SMS via Chan Dongle
- üìû **Call Control** - Complete call management and monitoring
- üéß **Queue Management** - Advanced call queue handling
- üìä **Real-time Monitoring** - Live event monitoring and logging
- ÔøΩÔ∏è **System Management** - Server shutdown, restart, and configuration reload
- ÔøΩüîß **CLI Commands** - Powerful command-line interface
- üìã **Interactive CLI** - User-friendly interactive console
- üåê **USSD Support** - Execute USSD commands seamlessly
- ‚ö° **Async Processing** - Asynchronous event handling with ReactPHP
- üîí **High Security** - Secure authentication and connection management
- üìÖ **Scheduled Operations** - Queue-based scheduled system operations

## üìã Requirements

- PHP >= 8.0
- Laravel >= 9.0
- Asterisk/Issabel server with AMI enabled
- Chan Dongle (for SMS and USSD functionality)
- Extension `ext-mbstring`

## üîÑ Version Compatibility

| Package Version | PHP Version | Laravel Version | Status     |
| --------------- | ----------- | --------------- | ---------- |
| 2.x             | 8.0+        | 9.0+            | ‚úÖ Current |
| 1.x             | 5.6+        | 5.1+            | ‚ö†Ô∏è Legacy  |

**Note**: Version 2.x includes modern PHP features like typed properties, match expressions, and improved performance.

## üöÄ Installation

### Step 1: Install via Composer

```bash
composer require shahkochaki/ami-laravel-asterisk-manager-interface
```

Or for the latest development version:

```bash
composer require shahkochaki/ami-laravel-asterisk-manager-interface:dev-master
```

### Step 2: Register Service Provider

**For Laravel 9+:** The service provider will be automatically discovered.

**For older versions:** Add to your `config/app.php` in the `providers` array:

```php
'providers' => [
    // Other providers...
    Shahkochaki\Ami\Providers\AmiServiceProvider::class,
]
```

### Step 3: Publish Configuration

```bash
php artisan vendor:publish --tag=ami
```

This will create the `config/ami.php` configuration file.

## üîÑ Upgrading from v1.x

If you're upgrading from an older version that supported PHP 5.6+ and Laravel 5.1+:

### 1. Update PHP and Laravel

```bash
# Make sure you have PHP 8.0+ and Laravel 9.0+
php --version
php artisan --version
```

### 2. Update the package

```bash
composer require shahkochaki/ami-laravel-asterisk-manager-interface
```

### 3. Update your code

- Replace `array_get()` helper with `Arr::get()`
- Update event listener syntax if needed
- Check deprecated Laravel features

### 4. Test thoroughly

```bash
php artisan ami:action Ping
```

## ‚öôÔ∏è Configuration

### AMI Configuration in Asterisk

Before using the package, you need to create an AMI user in Asterisk. Edit `/etc/asterisk/manager.conf`:

```ini
[general]
enabled = yes
port = 5038
bindaddr = 0.0.0.0

[myuser]
secret = mypassword
read = all
write = all
```

After making changes, reload Asterisk:

```bash
asterisk -rx "manager reload"
```

### Laravel Configuration

Edit the `config/ami.php` file:

```php
<?php

return [
    'host' => env('AMI_HOST', '127.0.0.1'),
    'port' => env('AMI_PORT', 5038),
    'username' => env('AMI_USERNAME', 'myuser'),
    'secret' => env('AMI_SECRET', 'mypassword'),

    'dongle' => [
        'sms' => [
            'device' => env('AMI_SMS_DEVICE', 'dongle0'),
        ],
    ],

    'events' => [
        // Event handlers configuration
        'Dial' => [
            // Custom event handlers
        ],
        'Hangup' => [
            // Custom event handlers
        ],
        // More events...
    ],
];
```

### Environment Variables (.env)

```env
AMI_HOST=192.168.1.100
AMI_PORT=5038
AMI_USERNAME=myuser
AMI_SECRET=mypassword
AMI_SMS_DEVICE=dongle0
```

## üéØ Usage

### üéß Event Listening

Listen to all AMI events:

```bash
php artisan ami:listen
```

With console logging:

```bash
php artisan ami:listen --monitor
```

In PHP code:

```php
use Illuminate\Support\Facades\Artisan;

Artisan::call('ami:listen');
```

### üìû Sending AMI Actions

```bash
# Example: Get channel status
php artisan ami:action Status

# Example: Originate a call
php artisan ami:action Originate --arguments=Channel:SIP/1001 --arguments=Context:default --arguments=Exten:1002 --arguments=Priority:1

# Example: Hangup a call
php artisan ami:action Hangup --arguments=Channel:SIP/1001-00000001
```

In PHP code:

```php
use Illuminate\Support\Facades\Artisan;

// Get channel status
Artisan::call('ami:action', [
    'action' => 'Status'
]);

// Originate a call
Artisan::call('ami:action', [
    'action' => 'Originate',
    '--arguments' => [
        'Channel' => 'SIP/1001',
        'Context' => 'default',
        'Exten' => '1002',
        'Priority' => '1'
    ]
]);
```

### üì± Sending SMS

Send regular SMS:

```bash
php artisan ami:dongle:sms 09123456789 "Hello, this is a test message"
```

Send long SMS (PDU mode):

```bash
php artisan ami:dongle:sms 09123456789 "Long message..." --pdu
```

Specify device:

```bash
php artisan ami:dongle:sms 09123456789 "Hello" dongle1
```

In PHP code:

```php
// Send regular SMS
Artisan::call('ami:dongle:sms', [
    'number' => '09123456789',
    'message' => 'Hello, this is a test message'
]);

// Send long SMS
Artisan::call('ami:dongle:sms', [
    'number' => '09123456789',
    'message' => 'Long message...',
    '--pdu' => true
]);
```

### üåê USSD Commands

```bash
php artisan ami:dongle:ussd dongle0 "*141#"
```

In PHP code:

```php
Artisan::call('ami:dongle:ussd', [
    'device' => 'dongle0',
    'ussd' => '*141#'
]);
```

### üíª Interactive CLI Interface

Start CLI interface:

```bash
php artisan ami:cli
```

Run command and auto-close:

```bash
php artisan ami:cli "core show channels" --autoclose
```

### üîß Usage without Laravel

```bash
php ./vendor/bin/ami ami:listen --host=192.168.1.100 --port=5038 --username=myuser --secret=mypass --monitor
```

## üìö Advanced Examples

### Event Management

```php
// In a Service Provider or Event Listener
use Illuminate\Support\Facades\Event;

Event::listen('ami.event.dial', function ($event) {
    Log::info('New call started', [
        'caller' => $event['CallerIDNum'],
        'destination' => $event['Destination']
    ]);
});

Event::listen('ami.event.hangup', function ($event) {
    Log::info('Call ended', [
        'channel' => $event['Channel'],
        'cause' => $event['Cause']
    ]);
});
```

### Custom Call Manager Class

```php
<?php

namespace App\Services;

use Illuminate\Support\Facades\Artisan;

class CallManager
{
    public function makeCall($from, $to, $context = 'default')
    {
        return Artisan::call('ami:action', [
            'action' => 'Originate',
            '--arguments' => [
                'Channel' => "SIP/{$from}",
                'Context' => $context,
                'Exten' => $to,
                'Priority' => '1',
                'CallerID' => $from
            ]
        ]);
    }

    public function hangupCall($channel)
    {
        return Artisan::call('ami:action', [
            'action' => 'Hangup',
            '--arguments' => [
                'Channel' => $channel
            ]
        ]);
    }

    public function getChannelStatus()
    {
        return Artisan::call('ami:action', [
            'action' => 'Status'
        ]);
    }
}
```

### Bulk SMS Service

```php
<?php

namespace App\Services;

use Illuminate\Support\Facades\Artisan;
use Illuminate\Support\Collection;

class BulkSmsService
{
    protected $device;

    public function __construct($device = null)
    {
        $this->device = $device ?: config('ami.dongle.sms.device');
    }

    public function sendBulkSms(Collection $recipients, string $message)
    {
        $results = [];

        foreach ($recipients as $number) {
            try {
                $result = Artisan::call('ami:dongle:sms', [
                    'number' => $number,
                    'message' => $message,
                    'device' => $this->device,
                    '--pdu' => strlen($message) > 160
                ]);

                $results[$number] = ['status' => 'success', 'result' => $result];

                // Small delay between messages
                usleep(500000); // 0.5 second

            } catch (\Exception $e) {
                $results[$number] = ['status' => 'error', 'message' => $e->getMessage()];
            }
        }

        return $results;
    }
}
```

## üîç Supported Events

The library supports all standard Asterisk events:

- **Call Events**: `Dial`, `Hangup`, `NewChannel`, `Bridge`
- **Agent Events**: `AgentConnect`, `AgentComplete`, `AgentLogin`, `AgentLogoff`
- **Queue Events**: `QueueMember`, `QueueParams`, `QueueSummary`
- **Dongle Events**: `DongleDeviceEntry`, `DongleSMSStatus`, `DongleUSSDStatus`
- **System Events**: `Reload`, `Shutdown`, `PeerStatus`

## üêõ Troubleshooting

### Common Issues

1. **Connection Error**:

   ```
   Connection refused
   ```

   - Check that Asterisk is running
   - Verify port 5038 is open
   - Check firewall settings

2. **Authentication Error**:

   ```
   Authentication failed
   ```

   - Verify username and password
   - Check AMI user permissions

3. **SMS Device Error**:
   ```
   Device not found
   ```
   - Check Chan Dongle status: `dongle show devices`
   - Verify device name is correct

### Logging

Enable detailed logging:

```bash
php artisan ami:listen --monitor
```

### Connection Testing

```bash
# Simple connection test
php artisan ami:action Ping

# Check dongle devices status
php artisan ami:action Command --arguments=Command:"dongle show devices"
```

## üîß Development

### Running Tests

```bash
composer test
```

### Code Standards

```bash
composer phpcs
```

### Project Structure

```
src/
‚îú‚îÄ‚îÄ Commands/          # Artisan commands
‚îÇ   ‚îú‚îÄ‚îÄ AmiAbstract.php
‚îÇ   ‚îú‚îÄ‚îÄ AmiAction.php
‚îÇ   ‚îú‚îÄ‚îÄ AmiCli.php
‚îÇ   ‚îú‚îÄ‚îÄ AmiListen.php
‚îÇ   ‚îú‚îÄ‚îÄ AmiSms.php
‚îÇ   ‚îî‚îÄ‚îÄ AmiUssd.php
‚îú‚îÄ‚îÄ Providers/         # Service providers
‚îÇ   ‚îî‚îÄ‚îÄ AmiServiceProvider.php
‚îú‚îÄ‚îÄ Factory.php        # AMI connection factory
‚îî‚îÄ‚îÄ Parser.php         # AMI protocol parser

config/
‚îî‚îÄ‚îÄ ami.php           # Configuration file

tests/                # Test files
‚îî‚îÄ‚îÄ ...
```

## ü§ù Contributing

We welcome contributions! Please:

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

### Development Guidelines

- Use PSR-4 autoloading
- Run tests before committing
- Add proper PHPDoc comments
- Follow Laravel conventions

## üìÑ License

This project is licensed under the [MIT License](LICENSE.md).

## üë®‚Äçüíª Author

**Ali Shahkochaki**

- Website: [shahkochaki.ir](https://shahkochaki.ir)
- Email: ali.shahkochaki7@gmail.com
- GitHub: [@shahkochaki](https://github.com/shahkochaki)

## üôè Acknowledgments

- [ReactPHP](https://reactphp.org/) for event loop
- [clue/ami-react](https://github.com/clue/reactphp-ami) for AMI protocol
- Laravel community for the amazing framework

## üìö Useful Resources

- [Asterisk Manager Interface](https://wiki.asterisk.org/wiki/display/AST/The+Asterisk+Manager+TCP+IP+API)
- [Chan Dongle Documentation](https://github.com/bg111/asterisk-chan-dongle)
- [Issabel Documentation](https://www.issabel.org/documentation/)

---

‚≠ê If this project helped you, please give it a star!

---

# AMI - ÿ±ÿßÿ®ÿ∑ ŸÖÿØ€åÿ±€åÿ™ Asterisk ÿ®ÿ±ÿß€å Laravel

<div align="center">
  
![ŸÑŸà⁄ØŸà AMI](https://raw.githubusercontent.com/shahkochaki/ami-laravel-asterisk-manager-interface/main/logo.png)

</div>

€å⁄© ⁄©ÿ™ÿßÿ®ÿÆÿßŸÜŸá ŸÇÿØÿ±ÿ™ŸÖŸÜÿØ Ÿà ÿ¢ÿ≥ÿßŸÜ ÿ®ÿ±ÿß€å ÿßÿ™ÿµÿßŸÑ ÿ≥ÿ±Ÿàÿ±Ÿáÿß€å Laravel ÿ®Ÿá ÿ≥ÿ±Ÿàÿ±Ÿáÿß€å VOIP ÿ®ÿ± ÿ±Ÿà€å ŸæŸÑÿ™ŸÅÿ±ŸÖ Issabel Ÿà Asterisk ÿßÿ≤ ÿ∑ÿ±€åŸÇ Asterisk Manager Interface (AMI).

## ‚ú® ÿßŸÖ⁄©ÿßŸÜÿßÿ™ ÿßÿµŸÑ€å

- üîó **ÿßÿ™ÿµÿßŸÑ ÿ¢ÿ≥ÿßŸÜ ÿ®Ÿá AMI** - ŸÖÿØ€åÿ±€åÿ™ ÿ≥ÿßÿØŸá ÿßÿ™ÿµÿßŸÑÿßÿ™
- üì± **ÿßÿ±ÿ≥ÿßŸÑ SMS** - ÿßÿ±ÿ≥ÿßŸÑ Ÿæ€åÿßŸÖ⁄© ÿßÿ≤ ÿ∑ÿ±€åŸÇ Chan Dongle
- üìû **⁄©ŸÜÿ™ÿ±ŸÑ ÿ™ŸÖÿßÿ≥‚ÄåŸáÿß** - ŸÖÿØ€åÿ±€åÿ™ ⁄©ÿßŸÖŸÑ Ÿà ŸÖÿßŸÜ€åÿ™Ÿàÿ±€åŸÜ⁄Ø ÿ™ŸÖÿßÿ≥‚ÄåŸáÿß
- üéß **ŸÖÿØ€åÿ±€åÿ™ ÿµŸÅ ÿ™ŸÖÿßÿ≥** - ŸÖÿØ€åÿ±€åÿ™ Ÿæ€åÿ¥ÿ±ŸÅÿ™Ÿá ÿµŸÅ‚ÄåŸáÿß€å ÿ™ŸÖÿßÿ≥
- üìä **ŸÖÿßŸÜ€åÿ™Ÿàÿ±€åŸÜ⁄Ø real-time** - ŸÖÿßŸÜ€åÿ™Ÿàÿ±€åŸÜ⁄Ø Ÿà ŸÑÿß⁄Ø‚Äå⁄Ø€åÿ±€å ÿ≤ŸÜÿØŸá ÿ±Ÿà€åÿØÿßÿØŸáÿß
- ÔøΩÔ∏è **ŸÖÿØ€åÿ±€åÿ™ ÿ≥€åÿ≥ÿ™ŸÖ** - ÿÆÿßŸÖŸàÿ¥ÿå ÿ±€åÿ≥ÿ™ Ÿà ÿ®ÿßÿ±⁄Ø€åÿ±€å ŸÖÿ¨ÿØÿØ ÿ≥ÿ±Ÿàÿ±
- ÔøΩüîß **ÿØÿ≥ÿ™Ÿàÿ±ÿßÿ™ CLI** - ÿ±ÿßÿ®ÿ∑ ÿÆÿ∑ ŸÅÿ±ŸÖÿßŸÜ ŸÇÿØÿ±ÿ™ŸÖŸÜÿØ
- üìã **ÿ±ÿßÿ®ÿ∑ ⁄©ÿßÿ±ÿ®ÿ±€å ÿ™ÿπÿßŸÖŸÑ€å** - ⁄©ŸÜÿ≥ŸàŸÑ ÿ™ÿπÿßŸÖŸÑ€å ⁄©ÿßÿ±ÿ®ÿ±Ÿæÿ≥ŸÜÿØ
- üåê **Ÿæÿ¥ÿ™€åÿ®ÿßŸÜ€å ÿßÿ≤ USSD** - ÿßÿ¨ÿ±ÿß€å ÿØÿ≥ÿ™Ÿàÿ±ÿßÿ™ USSD ÿ®Ÿá ÿµŸàÿ±ÿ™ €å⁄©Ÿæÿßÿ±⁄ÜŸá
- ‚ö° **Ÿæÿ±ÿØÿßÿ≤ÿ¥ ŸÜÿßŸáŸÖÿ≤ŸÖÿßŸÜ** - ŸÖÿØ€åÿ±€åÿ™ ÿ±Ÿà€åÿØÿßÿØŸáÿß€å ŸÜÿßŸáŸÖÿ≤ŸÖÿßŸÜ ÿ®ÿß ReactPHP
- üîí **ÿßŸÖŸÜ€åÿ™ ÿ®ÿßŸÑÿß** - ÿßÿ≠ÿ±ÿßÿ≤ ŸáŸà€åÿ™ ÿß€åŸÖŸÜ Ÿà ŸÖÿØ€åÿ±€åÿ™ ÿßÿ™ÿµÿßŸÑ
- üìÖ **ÿπŸÖŸÑ€åÿßÿ™ ÿ®ÿ±ŸÜÿßŸÖŸá‚Äåÿ±€åÿ≤€å ÿ¥ÿØŸá** - ÿπŸÖŸÑ€åÿßÿ™ ÿ≤ŸÖÿßŸÜ‚Äåÿ®ŸÜÿØ€å ÿ¥ÿØŸá ÿ®ÿß Queue

## üìã Ÿæ€åÿ¥‚ÄåŸÜ€åÿßÿ≤Ÿáÿß

- PHP >= 8.0
- Laravel >= 9.0
- ÿ≥ÿ±Ÿàÿ± Asterisk/Issabel ÿ®ÿß AMI ŸÅÿπÿßŸÑ
- Chan Dongle (ÿ®ÿ±ÿß€å ÿπŸÖŸÑ⁄©ÿ±ÿØ SMS Ÿà USSD)
- Extension `ext-mbstring`

## üîÑ ÿ≥ÿßÿ≤⁄Øÿßÿ±€å ŸÜÿ≥ÿÆŸá‚ÄåŸáÿß

| ŸÜÿ≥ÿÆŸá Ÿæ⁄©€åÿ¨ | ŸÜÿ≥ÿÆŸá PHP | ŸÜÿ≥ÿÆŸá Laravel | ÿßŸÖ⁄©ÿßŸÜÿßÿ™ ÿ¨ÿØ€åÿØ                  | Ÿàÿ∂ÿπ€åÿ™    |
| --------- | -------- | ------------ | ----------------------------- | -------- |
| 2.1+      | 8.0+     | 9.0+         | System Management, Queue Jobs | ‚úÖ ÿ¨ÿØ€åÿØ  |
| 2.0       | 8.0+     | 9.0+         | Modern PHP Features           | ‚úÖ ŸÅÿπŸÑ€å  |
| 1.x       | 5.6+     | 5.1+         | Basic AMI Operations          | ‚ö†Ô∏è ŸÇÿØ€åŸÖ€å |

**ÿ™Ÿàÿ¨Ÿá**: ŸÜÿ≥ÿÆŸá 2.1+ ÿ¥ÿßŸÖŸÑ ŸÖÿØ€åÿ±€åÿ™ ⁄©ÿßŸÖŸÑ ÿ≥€åÿ≥ÿ™ŸÖÿå ÿπŸÖŸÑ€åÿßÿ™ ÿ®ÿ±ŸÜÿßŸÖŸá‚Äåÿ±€åÿ≤€å ÿ¥ÿØŸá Ÿà Ÿà€å⁄ò⁄Ø€å‚ÄåŸáÿß€å Ÿæ€åÿ¥ÿ±ŸÅÿ™Ÿá ÿßÿ≥ÿ™.

### ŸÖŸÇÿß€åÿ≥Ÿá ÿßŸÖ⁄©ÿßŸÜÿßÿ™ ŸÜÿ≥ÿÆŸá‚ÄåŸáÿß

| Ÿà€å⁄ò⁄Ø€å                       | v1.x | v2.0 | v2.1+ |
| --------------------------- | ---- | ---- | ----- |
| AMI Connection              | ‚úÖ   | ‚úÖ   | ‚úÖ    |
| Event Listening             | ‚úÖ   | ‚úÖ   | ‚úÖ    |
| SMS Sending                 | ‚úÖ   | ‚úÖ   | ‚úÖ    |
| USSD Commands               | ‚úÖ   | ‚úÖ   | ‚úÖ    |
| Call Management             | ‚úÖ   | ‚úÖ   | ‚úÖ    |
| Interactive CLI             | ‚úÖ   | ‚úÖ   | ‚úÖ    |
| Modern PHP (8.0+)           | ‚ùå   | ‚úÖ   | ‚úÖ    |
| **System Management**       | ‚ùå   | ‚ùå   | ‚úÖ    |
| **Server Shutdown/Restart** | ‚ùå   | ‚ùå   | ‚úÖ    |
| **Configuration Reload**    | ‚ùå   | ‚ùå   | ‚úÖ    |
| **Health Monitoring**       | ‚ùå   | ‚ùå   | ‚úÖ    |
| **Scheduled Operations**    | ‚ùå   | ‚ùå   | ‚úÖ    |
| **Queue Jobs**              | ‚ùå   | ‚ùå   | ‚úÖ    |
| **SystemManager Service**   | ‚ùå   | ‚ùå   | ‚úÖ    |
| **Facade Support**          | ‚ùå   | ‚ùå   | ‚úÖ    |

## üöÄ ÿ¥ÿ±Ÿàÿπ ÿ≥ÿ±€åÿπ / Quick Start

### ŸÜÿµÿ® Ÿà ÿ±ÿßŸá‚ÄåÿßŸÜÿØÿßÿ≤€å ÿßŸàŸÑ€åŸá

```bash
# ŸÜÿµÿ® Ÿæ⁄©€åÿ¨
composer require shahkochaki/ami-laravel-asterisk-manager-interface

# ÿßŸÜÿ™ÿ¥ÿßÿ± ŸÅÿß€åŸÑ ÿ™ŸÜÿ∏€åŸÖÿßÿ™
php artisan vendor:publish --tag=ami

# ÿ™ŸÜÿ∏€åŸÖ ŸÖÿ™ÿ∫€åÿ±Ÿáÿß€å ŸÖÿ≠€åÿ∑€å
# ÿØÿ± ŸÅÿß€åŸÑ .env
AMI_HOST=192.168.1.100
AMI_PORT=5038
AMI_USERNAME=myuser
AMI_SECRET=mypassword
```

### ÿ™ÿ≥ÿ™ ÿßÿ™ÿµÿßŸÑ

```bash
# ÿ™ÿ≥ÿ™ ÿßÿ™ÿµÿßŸÑ ÿ≥ÿßÿØŸá
php artisan ami:action Ping

# ⁄ØŸàÿ¥ ÿØÿßÿØŸÜ ÿ®Ÿá ÿ±Ÿà€åÿØÿßÿØŸáÿß
php artisan ami:listen --monitor

# ÿØÿ±€åÿßŸÅÿ™ Ÿàÿ∂ÿπ€åÿ™ ÿ≥ÿ±Ÿàÿ±
php artisan ami:system status
```

### ŸÖÿ´ÿßŸÑ ÿ≥ÿ±€åÿπ ŸÖÿØ€åÿ±€åÿ™ ÿ≥€åÿ≥ÿ™ŸÖ

```php
use Shahkochaki\Ami\Services\SystemManager;

// ÿß€åÿ¨ÿßÿØ instance
$systemManager = new SystemManager();

// ÿØÿ±€åÿßŸÅÿ™ Ÿàÿ∂ÿπ€åÿ™ ÿ≥ÿ±Ÿàÿ±
$status = $systemManager->getServerStatus();
echo "Server Status: " . json_encode($status);

// ÿ±€åÿ≥ÿ™ ÿßŸÖŸÜ ÿ≥ÿ±Ÿàÿ±
$systemManager->restartServer(true, 'System update');
```

### ⁄ØÿßŸÖ 1: ŸÜÿµÿ® ÿßÿ≤ ÿ∑ÿ±€åŸÇ Composer

```bash
composer require shahkochaki/ami-laravel-asterisk-manager-interface
```

€åÿß ÿ®ÿ±ÿß€å ÿ¢ÿÆÿ±€åŸÜ ŸÜÿ≥ÿÆŸá ÿ™Ÿàÿ≥ÿπŸá:

```bash
composer require shahkochaki/ami-laravel-asterisk-manager-interface:dev-master
```

### ⁄ØÿßŸÖ 2: ÿ´ÿ®ÿ™ Service Provider

**ÿ®ÿ±ÿß€å Laravel 9+:** Service provider ÿ®Ÿá ÿµŸàÿ±ÿ™ ÿÆŸàÿØ⁄©ÿßÿ± ÿ™ÿ¥ÿÆ€åÿµ ÿØÿßÿØŸá ŸÖ€å‚Äåÿ¥ŸàÿØ.

**ÿ®ÿ±ÿß€å ŸÜÿ≥ÿÆŸá‚ÄåŸáÿß€å ŸÇÿØ€åŸÖ€å‚Äåÿ™ÿ±:** ÿØÿ± ŸÅÿß€åŸÑ `config/app.php` ÿØÿ± ÿ¢ÿ±ÿß€åŸá `providers` ÿßÿ∂ÿßŸÅŸá ⁄©ŸÜ€åÿØ:

```php
'providers' => [
    // ÿ≥ÿß€åÿ± providers...
    Shahkochaki\Ami\Providers\AmiServiceProvider::class,
]
```

### ⁄ØÿßŸÖ 3: ÿßŸÜÿ™ÿ¥ÿßÿ± ŸÅÿß€åŸÑ ÿ™ŸÜÿ∏€åŸÖÿßÿ™

```bash
php artisan vendor:publish --tag=ami
```

ÿß€åŸÜ ÿØÿ≥ÿ™Ÿàÿ± ŸÅÿß€åŸÑ `config/ami.php` ÿ±ÿß ÿß€åÿ¨ÿßÿØ ŸÖ€å‚Äå⁄©ŸÜÿØ.

## üîÑ ÿßÿ±ÿ™ŸÇÿß ÿßÿ≤ ŸÜÿ≥ÿÆŸá v1.x

ÿß⁄Øÿ± ÿßÿ≤ ŸÜÿ≥ÿÆŸá ŸÇÿØ€åŸÖ€å ⁄©Ÿá ÿßÿ≤ PHP 5.6+ Ÿà Laravel 5.1+ Ÿæÿ¥ÿ™€åÿ®ÿßŸÜ€å ŸÖ€å‚Äå⁄©ÿ±ÿØÿå ÿßÿ±ÿ™ŸÇÿß ŸÖ€å‚ÄåÿØŸá€åÿØ:

### 1. ÿ®Ÿá‚Äåÿ±Ÿàÿ≤ÿ±ÿ≥ÿßŸÜ€å PHP Ÿà Laravel

```bash
# ŸÖÿ∑ŸÖÿ¶ŸÜ ÿ¥Ÿà€åÿØ ⁄©Ÿá PHP 8.0+ Ÿà Laravel 9.0+ ÿØÿßÿ±€åÿØ
php --version
php artisan --version
```

### 2. ÿ®Ÿá‚Äåÿ±Ÿàÿ≤ÿ±ÿ≥ÿßŸÜ€å Ÿæ⁄©€åÿ¨

```bash
composer require shahkochaki/ami-laravel-asterisk-manager-interface
```

### 3. ÿ®Ÿá‚Äåÿ±Ÿàÿ≤ÿ±ÿ≥ÿßŸÜ€å ⁄©ÿØ ÿ¥ŸÖÿß

- `array_get()` helper ÿ±ÿß ÿ®ÿß `Arr::get()` ÿ¨ÿß€å⁄Øÿ≤€åŸÜ ⁄©ŸÜ€åÿØ
- syntax event listener ÿ±ÿß ÿØÿ± ÿµŸàÿ±ÿ™ ŸÜ€åÿßÿ≤ ÿ®Ÿá‚Äåÿ±Ÿàÿ≤ÿ±ÿ≥ÿßŸÜ€å ⁄©ŸÜ€åÿØ
- Ÿà€å⁄ò⁄Ø€å‚ÄåŸáÿß€å deprecated Laravel ÿ±ÿß ÿ®ÿ±ÿ±ÿ≥€å ⁄©ŸÜ€åÿØ

### 4. ÿ™ÿ≥ÿ™ ⁄©ÿßŸÖŸÑ

```bash
php artisan ami:action Ping
```

## ‚öôÔ∏è ÿ™ŸÜÿ∏€åŸÖÿßÿ™

### ÿ™ŸÜÿ∏€åŸÖÿßÿ™ AMI ÿØÿ± Asterisk

ŸÇÿ®ŸÑ ÿßÿ≤ ÿßÿ≥ÿ™ŸÅÿßÿØŸáÿå ÿ®ÿß€åÿØ €å⁄© ⁄©ÿßÿ±ÿ®ÿ± AMI ÿØÿ± Asterisk ÿß€åÿ¨ÿßÿØ ⁄©ŸÜ€åÿØ. ŸÅÿß€åŸÑ `/etc/asterisk/manager.conf` ÿ±ÿß Ÿà€åÿ±ÿß€åÿ¥ ⁄©ŸÜ€åÿØ:

```ini
[general]
enabled = yes
port = 5038
bindaddr = 0.0.0.0

[myuser]
secret = mypassword
read = all
write = all
```

Ÿæÿ≥ ÿßÿ≤ ÿ™ÿ∫€å€åÿ±ÿßÿ™ÿå Asterisk ÿ±ÿß reload ⁄©ŸÜ€åÿØ:

```bash
asterisk -rx "manager reload"
```

### ÿ™ŸÜÿ∏€åŸÖÿßÿ™ Laravel

```php
<?php

return [
    'host' => env('AMI_HOST', '127.0.0.1'),
    'port' => env('AMI_PORT', 5038),
    'username' => env('AMI_USERNAME', 'myuser'),
    'secret' => env('AMI_SECRET', 'mypassword'),

    'dongle' => [
        'sms' => [
            'device' => env('AMI_SMS_DEVICE', 'dongle0'),
        ],
    ],

    'events' => [
        // ÿ™ŸÜÿ∏€åŸÖÿßÿ™ ŸÖÿØ€åÿ±€åÿ™ ÿ±Ÿà€åÿØÿßÿØŸáÿß
        'Dial' => [
            // ŸÖÿØ€åÿ±€åÿ™‚Äå⁄©ŸÜŸÜÿØŸá‚ÄåŸáÿß€å ÿ≥ŸÅÿßÿ±ÿ¥€å ÿ±Ÿà€åÿØÿßÿØ
        ],
        'Hangup' => [
            // ŸÖÿØ€åÿ±€åÿ™‚Äå⁄©ŸÜŸÜÿØŸá‚ÄåŸáÿß€å ÿ≥ŸÅÿßÿ±ÿ¥€å ÿ±Ÿà€åÿØÿßÿØ
        ],
        // ÿ±Ÿà€åÿØÿßÿØŸáÿß€å ÿ®€åÿ¥ÿ™ÿ±...
    ],
];
```

### ŸÖÿ™ÿ∫€åÿ±Ÿáÿß€å ŸÖÿ≠€åÿ∑€å (.env)

```env
AMI_HOST=192.168.1.100
AMI_PORT=5038
AMI_USERNAME=myuser
AMI_SECRET=mypassword
AMI_SMS_DEVICE=dongle0
```

## üéØ ÿßÿ≥ÿ™ŸÅÿßÿØŸá

### üéß ⁄ØŸàÿ¥ ÿØÿßÿØŸÜ ÿ®Ÿá ÿ±Ÿà€åÿØÿßÿØŸáÿß

⁄ØŸàÿ¥ ÿØÿßÿØŸÜ ÿ®Ÿá ÿ™ŸÖÿßŸÖ ÿ±Ÿà€åÿØÿßÿØŸáÿß€å AMI:

```bash
php artisan ami:listen
```

ÿ®ÿß ŸÜŸÖÿß€åÿ¥ log ÿØÿ± ⁄©ŸÜÿ≥ŸàŸÑ:

```bash
php artisan ami:listen --monitor
```

ÿØÿ± ⁄©ÿØ PHP:

```php
use Illuminate\Support\Facades\Artisan;

Artisan::call('ami:listen');
```

### üìû ÿßÿ±ÿ≥ÿßŸÑ ÿØÿ≥ÿ™Ÿàÿ±ÿßÿ™ AMI

```bash
# ŸÖÿ´ÿßŸÑ: Ÿàÿ∂ÿπ€åÿ™ ⁄©ÿßŸÜÿßŸÑ‚ÄåŸáÿß
php artisan ami:action Status

# ŸÖÿ´ÿßŸÑ: ÿ®ÿ±ŸÇÿ±ÿßÿ±€å ÿ™ŸÖÿßÿ≥
php artisan ami:action Originate --arguments=Channel:SIP/1001 --arguments=Context:default --arguments=Exten:1002 --arguments=Priority:1

# ŸÖÿ´ÿßŸÑ: ŸÇÿ∑ÿπ ÿ™ŸÖÿßÿ≥
php artisan ami:action Hangup --arguments=Channel:SIP/1001-00000001
```

ÿØÿ± ⁄©ÿØ PHP:

```php
use Illuminate\Support\Facades\Artisan;

// ÿØÿ±€åÿßŸÅÿ™ Ÿàÿ∂ÿπ€åÿ™ ⁄©ÿßŸÜÿßŸÑ‚ÄåŸáÿß
Artisan::call('ami:action', [
    'action' => 'Status'
]);

// ÿ®ÿ±ŸÇÿ±ÿßÿ±€å ÿ™ŸÖÿßÿ≥
Artisan::call('ami:action', [
    'action' => 'Originate',
    '--arguments' => [
        'Channel' => 'SIP/1001',
        'Context' => 'default',
        'Exten' => '1002',
        'Priority' => '1'
    ]
]);
```

### üì± ÿßÿ±ÿ≥ÿßŸÑ SMS

ÿßÿ±ÿ≥ÿßŸÑ SMS ŸÖÿπŸÖŸàŸÑ€å:

```bash
php artisan ami:dongle:sms 09123456789 "ÿ≥ŸÑÿßŸÖÿå ÿß€åŸÜ €å⁄© Ÿæ€åÿßŸÖ ÿ™ÿ≥ÿ™ ÿßÿ≥ÿ™"
```

ÿßÿ±ÿ≥ÿßŸÑ SMS ÿ∑ŸàŸÑÿßŸÜ€å (ÿ≠ÿßŸÑÿ™ PDU):

```bash
php artisan ami:dongle:sms 09123456789 "Ÿæ€åÿßŸÖ ÿ∑ŸàŸÑÿßŸÜ€å..." --pdu
```

ŸÖÿ¥ÿÆÿµ ⁄©ÿ±ÿØŸÜ ÿØÿ≥ÿ™⁄ØÿßŸá:

```bash
php artisan ami:dongle:sms 09123456789 "ÿ≥ŸÑÿßŸÖ" dongle1
```

ÿØÿ± ⁄©ÿØ PHP:

```php
// ÿßÿ±ÿ≥ÿßŸÑ SMS ŸÖÿπŸÖŸàŸÑ€å
Artisan::call('ami:dongle:sms', [
    'number' => '09123456789',
    'message' => 'ÿ≥ŸÑÿßŸÖÿå ÿß€åŸÜ €å⁄© Ÿæ€åÿßŸÖ ÿ™ÿ≥ÿ™ ÿßÿ≥ÿ™'
]);

// ÿßÿ±ÿ≥ÿßŸÑ SMS ÿ∑ŸàŸÑÿßŸÜ€å
Artisan::call('ami:dongle:sms', [
    'number' => '09123456789',
    'message' => 'Ÿæ€åÿßŸÖ ÿ∑ŸàŸÑÿßŸÜ€å...',
    '--pdu' => true
]);
```

### üåê ÿßÿ±ÿ≥ÿßŸÑ ÿØÿ≥ÿ™Ÿàÿ±ÿßÿ™ USSD

```bash
php artisan ami:dongle:ussd dongle0 "*141#"
```

ÿØÿ± ⁄©ÿØ PHP:

```php
Artisan::call('ami:dongle:ussd', [
    'device' => 'dongle0',
    'ussd' => '*141#'
]);
```

### üíª ÿ±ÿßÿ®ÿ∑ ÿÆÿ∑ ŸÅÿ±ŸÖÿßŸÜ ÿ™ÿπÿßŸÖŸÑ€å

ÿ¥ÿ±Ÿàÿπ ÿ±ÿßÿ®ÿ∑ CLI:

```bash
php artisan ami:cli
```

ÿßÿ¨ÿ±ÿß€å ÿØÿ≥ÿ™Ÿàÿ± Ÿà ÿ®ÿ≥ÿ™ŸÜ ÿÆŸàÿØ⁄©ÿßÿ±:

```bash
php artisan ami:cli "core show channels" --autoclose
```

### üîß ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿ®ÿØŸàŸÜ Laravel

```bash
php ./vendor/bin/ami ami:listen --host=192.168.1.100 --port=5038 --username=myuser --secret=mypass --monitor
```

## üìö ŸÖÿ´ÿßŸÑ‚ÄåŸáÿß€å Ÿæ€åÿ¥ÿ±ŸÅÿ™Ÿá

### ŸÖÿØ€åÿ±€åÿ™ ÿ±Ÿà€åÿØÿßÿØŸáÿß

```php
// ÿØÿ± €å⁄© Service Provider €åÿß Event Listener
use Illuminate\Support\Facades\Event;

Event::listen('ami.event.dial', function ($event) {
    Log::info('ÿ™ŸÖÿßÿ≥ ÿ¨ÿØ€åÿØ ÿ¥ÿ±Ÿàÿπ ÿ¥ÿØ', [
        'caller' => $event['CallerIDNum'],
        'destination' => $event['Destination']
    ]);
});

Event::listen('ami.event.hangup', function ($event) {
    Log::info('ÿ™ŸÖÿßÿ≥ Ÿæÿß€åÿßŸÜ €åÿßŸÅÿ™', [
        'channel' => $event['Channel'],
        'cause' => $event['Cause']
    ]);
});
```

### ÿß€åÿ¨ÿßÿØ ⁄©ŸÑÿßÿ≥ ÿ≥ŸÅÿßÿ±ÿ¥€å ÿ®ÿ±ÿß€å ŸÖÿØ€åÿ±€åÿ™ ÿ™ŸÖÿßÿ≥‚ÄåŸáÿß

```php
<?php

namespace App\Services;

use Illuminate\Support\Facades\Artisan;

class CallManager
{
    public function makeCall($from, $to, $context = 'default')
    {
        return Artisan::call('ami:action', [
            'action' => 'Originate',
            '--arguments' => [
                'Channel' => "SIP/{$from}",
                'Context' => $context,
                'Exten' => $to,
                'Priority' => '1',
                'CallerID' => $from
            ]
        ]);
    }

    public function hangupCall($channel)
    {
        return Artisan::call('ami:action', [
            'action' => 'Hangup',
            '--arguments' => [
                'Channel' => $channel
            ]
        ]);
    }

    public function getChannelStatus()
    {
        return Artisan::call('ami:action', [
            'action' => 'Status'
        ]);
    }
}
```

### ÿ≥ÿ±Ÿà€åÿ≥ ÿßÿ±ÿ≥ÿßŸÑ SMS ÿßŸÜÿ®ŸàŸá

```php
<?php

namespace App\Services;

use Illuminate\Support\Facades\Artisan;
use Illuminate\Support\Collection;

class BulkSmsService
{
    protected $device;

    public function __construct($device = null)
    {
        $this->device = $device ?: config('ami.dongle.sms.device');
    }

    public function sendBulkSms(Collection $recipients, string $message)
    {
        $results = [];

        foreach ($recipients as $number) {
            try {
                $result = Artisan::call('ami:dongle:sms', [
                    'number' => $number,
                    'message' => $message,
                    'device' => $this->device,
                    '--pdu' => strlen($message) > 160
                ]);

                $results[$number] = ['status' => 'success', 'result' => $result];

                // ÿ™ÿ£ÿÆ€åÿ± ⁄©Ÿàÿ™ÿßŸá ÿ®€åŸÜ ÿßÿ±ÿ≥ÿßŸÑ Ÿæ€åÿßŸÖ‚ÄåŸáÿß
                usleep(500000); // ŸÜ€åŸÖ ÿ´ÿßŸÜ€åŸá

            } catch (\Exception $e) {
                $results[$number] = ['status' => 'error', 'message' => $e->getMessage()];
            }
        }

        return $results;
    }
}
```

## üîç ÿ±Ÿà€åÿØÿßÿØŸáÿß€å Ÿæÿ¥ÿ™€åÿ®ÿßŸÜ€å ÿ¥ÿØŸá

⁄©ÿ™ÿßÿ®ÿÆÿßŸÜŸá ÿßÿ≤ ÿ™ŸÖÿßŸÖ ÿ±Ÿà€åÿØÿßÿØŸáÿß€å ÿßÿ≥ÿ™ÿßŸÜÿØÿßÿ±ÿØ Asterisk Ÿæÿ¥ÿ™€åÿ®ÿßŸÜ€å ŸÖ€å‚Äå⁄©ŸÜÿØ:

- **ÿ±Ÿà€åÿØÿßÿØŸáÿß€å ÿ™ŸÖÿßÿ≥**: `Dial`, `Hangup`, `NewChannel`, `Bridge`
- **ÿ±Ÿà€åÿØÿßÿØŸáÿß€å ÿßŸæÿ±ÿßÿ™Ÿàÿ±**: `AgentConnect`, `AgentComplete`, `AgentLogin`, `AgentLogoff`
- **ÿ±Ÿà€åÿØÿßÿØŸáÿß€å ÿµŸÅ**: `QueueMember`, `QueueParams`, `QueueSummary`
- **ÿ±Ÿà€åÿØÿßÿØŸáÿß€å Dongle**: `DongleDeviceEntry`, `DongleSMSStatus`, `DongleUSSDStatus`
- **ÿ±Ÿà€åÿØÿßÿØŸáÿß€å ÿ≥€åÿ≥ÿ™ŸÖ**: `Reload`, `Shutdown`, `PeerStatus`

## üêõ ÿπ€åÿ®‚Äå€åÿßÿ®€å

### ŸÖÿ¥⁄©ŸÑÿßÿ™ ÿ±ÿß€åÿ¨

1. **ÿÆÿ∑ÿß€å ÿßÿ™ÿµÿßŸÑ**:

   ```
   Connection refused
   ```

   - ÿ®ÿ±ÿ±ÿ≥€å ⁄©ŸÜ€åÿØ ⁄©Ÿá Asterisk ÿØÿ± ÿ≠ÿßŸÑ ÿßÿ¨ÿ±ÿß ÿ®ÿßÿ¥ÿØ
   - ŸæŸàÿ±ÿ™ 5038 ÿ®ÿßÿ≤ ÿ®ÿßÿ¥ÿØ
   - ÿ™ŸÜÿ∏€åŸÖÿßÿ™ ŸÅÿß€åÿ±ŸàÿßŸÑ ÿ±ÿß ÿ®ÿ±ÿ±ÿ≥€å ⁄©ŸÜ€åÿØ

2. **ÿÆÿ∑ÿß€å ÿßÿ≠ÿ±ÿßÿ≤ ŸáŸà€åÿ™**:

   ```
   Authentication failed
   ```

   - ŸÜÿßŸÖ ⁄©ÿßÿ±ÿ®ÿ±€å Ÿà ÿ±ŸÖÿ≤ ÿπÿ®Ÿàÿ± ÿ±ÿß ÿ®ÿ±ÿ±ÿ≥€å ⁄©ŸÜ€åÿØ
   - ÿØÿ≥ÿ™ÿ±ÿ≥€å‚ÄåŸáÿß€å ⁄©ÿßÿ±ÿ®ÿ± AMI ÿ±ÿß ÿ®ÿ±ÿ±ÿ≥€å ⁄©ŸÜ€åÿØ

3. **ŸÖÿ¥⁄©ŸÑ ÿßÿ±ÿ≥ÿßŸÑ SMS**:
   ```
   Device not found
   ```
   - Ÿàÿ∂ÿπ€åÿ™ Chan Dongle ÿ±ÿß ÿ®ÿ±ÿ±ÿ≥€å ⁄©ŸÜ€åÿØ: `dongle show devices`
   - ŸÜÿßŸÖ ÿØÿ≥ÿ™⁄ØÿßŸá ÿ±ÿß ÿØÿ±ÿ≥ÿ™ Ÿàÿßÿ±ÿØ ⁄©ÿ±ÿØŸá‚Äåÿß€åÿØ

### ŸÑÿß⁄Ø‚ÄåŸáÿß

ÿ®ÿ±ÿß€å ŸÅÿπÿßŸÑ‚Äåÿ≥ÿßÿ≤€å ŸÑÿß⁄Ø‚ÄåŸáÿß€å ÿ™ŸÅÿµ€åŸÑ€å:

```bash
php artisan ami:listen --monitor
```

### ÿ™ÿ≥ÿ™ ÿßÿ™ÿµÿßŸÑ

```bash
# ÿ™ÿ≥ÿ™ ÿ≥ÿßÿØŸá ÿßÿ™ÿµÿßŸÑ
php artisan ami:action Ping

# ÿ®ÿ±ÿ±ÿ≥€å Ÿàÿ∂ÿπ€åÿ™ ÿØÿ≥ÿ™⁄ØÿßŸá‚ÄåŸáÿß€å dongle
php artisan ami:action Command --arguments=Command:"dongle show devices"
```

## üîß ÿ™Ÿàÿ≥ÿπŸá

### ÿßÿ¨ÿ±ÿß€å ÿ™ÿ≥ÿ™‚ÄåŸáÿß

```bash
composer test
```

### ÿßÿ≥ÿ™ÿßŸÜÿØÿßÿ±ÿØŸáÿß€å ⁄©ÿØ

```bash
composer phpcs
```

### ÿ≥ÿßÿÆÿ™ÿßÿ± Ÿæÿ±Ÿà⁄òŸá

```
src/
‚îú‚îÄ‚îÄ Commands/          # ÿØÿ≥ÿ™Ÿàÿ±ÿßÿ™ Artisan
‚îÇ   ‚îú‚îÄ‚îÄ AmiAbstract.php
‚îÇ   ‚îú‚îÄ‚îÄ AmiAction.php
‚îÇ   ‚îú‚îÄ‚îÄ AmiCli.php
‚îÇ   ‚îú‚îÄ‚îÄ AmiListen.php
‚îÇ   ‚îú‚îÄ‚îÄ AmiSms.php
‚îÇ   ‚îî‚îÄ‚îÄ AmiUssd.php
‚îú‚îÄ‚îÄ Providers/         # Service providers
‚îÇ   ‚îî‚îÄ‚îÄ AmiServiceProvider.php
‚îú‚îÄ‚îÄ Factory.php        # ⁄©ÿßÿ±ÿÆÿßŸÜŸá ÿßÿ™ÿµÿßŸÑ AMI
‚îî‚îÄ‚îÄ Parser.php         # ÿ™ÿ¨ÿ≤€åŸá‚Äå⁄©ŸÜŸÜÿØŸá Ÿæÿ±Ÿàÿ™⁄©ŸÑ AMI

config/
‚îî‚îÄ‚îÄ ami.php           # ŸÅÿß€åŸÑ ÿ™ŸÜÿ∏€åŸÖÿßÿ™

tests/                # ŸÅÿß€åŸÑ‚ÄåŸáÿß€å ÿ™ÿ≥ÿ™
‚îî‚îÄ‚îÄ ...
```

## ü§ù ŸÖÿ¥ÿßÿ±⁄©ÿ™

ÿßÿ≤ ŸÖÿ¥ÿßÿ±⁄©ÿ™ ÿ¥ŸÖÿß ÿßÿ≥ÿ™ŸÇÿ®ÿßŸÑ ŸÖ€å‚Äå⁄©ŸÜ€åŸÖ! ŸÑÿ∑ŸÅÿßŸã:

1. Ÿæÿ±Ÿà⁄òŸá ÿ±ÿß Fork ⁄©ŸÜ€åÿØ
2. €å⁄© branch ÿ¨ÿØ€åÿØ ÿß€åÿ¨ÿßÿØ ⁄©ŸÜ€åÿØ (`git checkout -b feature/amazing-feature`)
3. ÿ™ÿ∫€å€åÿ±ÿßÿ™ ÿ±ÿß commit ⁄©ŸÜ€åÿØ (`git commit -m 'Add amazing feature'`)
4. ÿ®Ÿá branch ÿÆŸàÿØ push ⁄©ŸÜ€åÿØ (`git push origin feature/amazing-feature`)
5. €å⁄© Pull Request ÿß€åÿ¨ÿßÿØ ⁄©ŸÜ€åÿØ

### ÿ±ÿßŸáŸÜŸÖÿß€å ÿ™Ÿàÿ≥ÿπŸá

- ÿßÿ≤ PSR-4 autoloading ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ
- ÿ™ÿ≥ÿ™‚ÄåŸáÿß ÿ±ÿß ÿßÿ¨ÿ±ÿß ⁄©ŸÜ€åÿØ ŸÇÿ®ŸÑ ÿßÿ≤ commit
- PHPDoc ŸÖŸÜÿßÿ≥ÿ® ÿßÿ∂ÿßŸÅŸá ⁄©ŸÜ€åÿØ
- ÿßÿ≤ ÿßÿ≥ÿ™ÿßŸÜÿØÿßÿ±ÿØŸáÿß€å Laravel Ÿæ€åÿ±Ÿà€å ⁄©ŸÜ€åÿØ

## üìÑ ŸÖÿ¨Ÿàÿ≤

ÿß€åŸÜ Ÿæÿ±Ÿà⁄òŸá ÿ™ÿ≠ÿ™ ŸÖÿ¨Ÿàÿ≤ [MIT License](LICENSE.md) ŸÖŸÜÿ™ÿ¥ÿ± ÿ¥ÿØŸá ÿßÿ≥ÿ™.

## üë®‚Äçüíª ÿ≥ÿßÿ≤ŸÜÿØŸá

**Ali Shahkochaki**

- Ÿàÿ®‚Äåÿ≥ÿß€åÿ™: [shahkochaki.ir](https://shahkochaki.ir)
- ÿß€åŸÖ€åŸÑ: ali.shahkochaki7@gmail.com
- ⁄Ø€åÿ™‚ÄåŸáÿßÿ®: [@shahkochaki](https://github.com/shahkochaki)

## üôè ÿ™ÿ¥⁄©ÿ±

- [ReactPHP](https://reactphp.org/) ÿ®ÿ±ÿß€å event loop
- [clue/ami-react](https://github.com/clue/reactphp-ami) ÿ®ÿ±ÿß€å Ÿæÿ±Ÿàÿ™⁄©ŸÑ AMI
- ÿ¨ÿßŸÖÿπŸá Laravel ÿ®ÿ±ÿß€å ŸÅÿ±€åŸÖŸàÿ±⁄© ŸÅŸàŸÇ‚ÄåÿßŸÑÿπÿßÿØŸá

## üìö ŸÖŸÜÿßÿ®ÿπ ŸÖŸÅ€åÿØ

- [Asterisk Manager Interface](https://wiki.asterisk.org/wiki/display/AST/The+Asterisk+Manager+TCP+IP+API)
- [ŸÖÿ≥ÿ™ŸÜÿØÿßÿ™ Chan Dongle](https://github.com/bg111/asterisk-chan-dongle)
- [ŸÖÿ≥ÿ™ŸÜÿØÿßÿ™ Issabel](https://www.issabel.org/documentation/)

---

‚≠ê ÿß⁄Øÿ± ÿß€åŸÜ Ÿæÿ±Ÿà⁄òŸá ÿ®ÿ±ÿß€åÿ™ÿßŸÜ ŸÖŸÅ€åÿØ ÿ®ŸàÿØÿå ŸÑÿ∑ŸÅÿßŸã ÿ≥ÿ™ÿßÿ±Ÿá ÿ®ÿØŸá€åÿØ!

**Made with ‚ù§Ô∏è for Iranian developers**
'secret' => env('AMI_SECRET', 'mypassword'),

    'dongle' => [
        'sms' => [
            'device' => env('AMI_SMS_DEVICE', 'dongle0'),
        ],
    ],

    'events' => [
        // Event handlers configuration
        'Dial' => [
            // Custom event handlers
        ],
        'Hangup' => [
            // Custom event handlers
        ],
        // More events...
    ],

];

````

### ŸÖÿ™ÿ∫€åÿ±Ÿáÿß€å ŸÖÿ≠€åÿ∑€å (.env)

```env
AMI_HOST=192.168.1.100
AMI_PORT=5038
AMI_USERNAME=myuser
AMI_SECRET=mypassword
AMI_SMS_DEVICE=dongle0
````

## üéØ ÿßÿ≥ÿ™ŸÅÿßÿØŸá / Usage

### üéß ⁄ØŸàÿ¥ ÿØÿßÿØŸÜ ÿ®Ÿá ÿ±Ÿà€åÿØÿßÿØŸáÿß / Event Listening

⁄ØŸàÿ¥ ÿØÿßÿØŸÜ ÿ®Ÿá ÿ™ŸÖÿßŸÖ ÿ±Ÿà€åÿØÿßÿØŸáÿß€å AMI:

```bash
php artisan ami:listen
```

ÿ®ÿß ŸÜŸÖÿß€åÿ¥ log ÿØÿ± ⁄©ŸÜÿ≥ŸàŸÑ:

```bash
php artisan ami:listen --monitor
```

ÿØÿ± ⁄©ÿØ PHP:

```php
use Illuminate\Support\Facades\Artisan;

Artisan::call('ami:listen');
```

### üìû ÿßÿ±ÿ≥ÿßŸÑ ÿØÿ≥ÿ™Ÿàÿ±ÿßÿ™ AMI / Sending AMI Actions

```bash
# ŸÖÿ´ÿßŸÑ: Ÿàÿ∂ÿπ€åÿ™ ⁄©ÿßŸÜÿßŸÑ‚ÄåŸáÿß
php artisan ami:action Status

# ŸÖÿ´ÿßŸÑ: ÿ®ÿ±ŸÇÿ±ÿßÿ±€å ÿ™ŸÖÿßÿ≥
php artisan ami:action Originate --arguments=Channel:SIP/1001 --arguments=Context:default --arguments=Exten:1002 --arguments=Priority:1

# ŸÖÿ´ÿßŸÑ: ŸÇÿ∑ÿπ ÿ™ŸÖÿßÿ≥
php artisan ami:action Hangup --arguments=Channel:SIP/1001-00000001
```

ÿØÿ± ⁄©ÿØ PHP:

```php
use Illuminate\Support\Facades\Artisan;

// ÿØÿ±€åÿßŸÅÿ™ Ÿàÿ∂ÿπ€åÿ™ ⁄©ÿßŸÜÿßŸÑ‚ÄåŸáÿß
Artisan::call('ami:action', [
    'action' => 'Status'
]);

// ÿ®ÿ±ŸÇÿ±ÿßÿ±€å ÿ™ŸÖÿßÿ≥
Artisan::call('ami:action', [
    'action' => 'Originate',
    '--arguments' => [
        'Channel' => 'SIP/1001',
        'Context' => 'default',
        'Exten' => '1002',
        'Priority' => '1'
    ]
]);
```

### üì± ÿßÿ±ÿ≥ÿßŸÑ SMS / Sending SMS

ÿßÿ±ÿ≥ÿßŸÑ SMS ŸÖÿπŸÖŸàŸÑ€å:

```bash
php artisan ami:dongle:sms 09123456789 "ÿ≥ŸÑÿßŸÖÿå ÿß€åŸÜ €å⁄© Ÿæ€åÿßŸÖ ÿ™ÿ≥ÿ™ ÿßÿ≥ÿ™"
```

ÿßÿ±ÿ≥ÿßŸÑ SMS ÿ∑ŸàŸÑÿßŸÜ€å (PDU mode):

```bash
php artisan ami:dongle:sms 09123456789 "Ÿæ€åÿßŸÖ ÿ∑ŸàŸÑÿßŸÜ€å..." --pdu
```

ŸÖÿ¥ÿÆÿµ ⁄©ÿ±ÿØŸÜ ÿØÿ≥ÿ™⁄ØÿßŸá:

```bash
php artisan ami:dongle:sms 09123456789 "ÿ≥ŸÑÿßŸÖ" dongle1
```

ÿØÿ± ⁄©ÿØ PHP:

```php
// ÿßÿ±ÿ≥ÿßŸÑ SMS ŸÖÿπŸÖŸàŸÑ€å
Artisan::call('ami:dongle:sms', [
    'number' => '09123456789',
    'message' => 'ÿ≥ŸÑÿßŸÖÿå ÿß€åŸÜ €å⁄© Ÿæ€åÿßŸÖ ÿ™ÿ≥ÿ™ ÿßÿ≥ÿ™'
]);

// ÿßÿ±ÿ≥ÿßŸÑ SMS ÿ∑ŸàŸÑÿßŸÜ€å
Artisan::call('ami:dongle:sms', [
    'number' => '09123456789',
    'message' => 'Ÿæ€åÿßŸÖ ÿ∑ŸàŸÑÿßŸÜ€å...',
    '--pdu' => true
]);
```

### üåê ÿßÿ±ÿ≥ÿßŸÑ ÿØÿ≥ÿ™Ÿàÿ±ÿßÿ™ USSD / USSD Commands

```bash
php artisan ami:dongle:ussd dongle0 "*141#"
```

ÿØÿ± ⁄©ÿØ PHP:

```php
Artisan::call('ami:dongle:ussd', [
    'device' => 'dongle0',
    'ussd' => '*141#'
]);
```

### üíª ÿ±ÿßÿ®ÿ∑ ÿÆÿ∑ ŸÅÿ±ŸÖÿßŸÜ ÿ™ÿπÿßŸÖŸÑ€å / Interactive CLI

ÿ¥ÿ±Ÿàÿπ ÿ±ÿßÿ®ÿ∑ CLI:

```bash
php artisan ami:cli
```

ÿßÿ¨ÿ±ÿß€å ÿØÿ≥ÿ™Ÿàÿ± Ÿà ÿ®ÿ≥ÿ™ŸÜ ÿÆŸàÿØ⁄©ÿßÿ±:

```bash
php artisan ami:cli "core show channels" --autoclose
```

### üîß ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿ®ÿØŸàŸÜ Laravel / Without Laravel

```bash
php ./vendor/bin/ami ami:listen --host=192.168.1.100 --port=5038 --username=myuser --secret=mypass --monitor
```

### üñ•Ô∏è ŸÖÿØ€åÿ±€åÿ™ ÿ≥€åÿ≥ÿ™ŸÖ / System Management

**ÿ¨ÿØ€åÿØ!** ÿßŸÖ⁄©ÿßŸÜ ⁄©ŸÜÿ™ÿ±ŸÑ ⁄©ÿßŸÖŸÑ ÿ≥ÿ±Ÿàÿ± Asterisk/Issabel:

#### ÿÆÿßŸÖŸàÿ¥ ⁄©ÿ±ÿØŸÜ Ÿà ÿ±€åÿ≥ÿ™ ÿ≥ÿ±Ÿàÿ± / Server Shutdown & Restart

```bash
# ÿÆÿßŸÖŸàÿ¥ ⁄©ÿ±ÿØŸÜ ÿ™ÿØÿ±€åÿ¨€å ÿ≥ÿ±Ÿàÿ±
php artisan ami:system shutdown --graceful

# ÿ±€åÿ≥ÿ™ ŸÅŸàÿ±€å ÿ≥ÿ±Ÿàÿ±
php artisan ami:system restart --force

# ÿØÿ±€åÿßŸÅÿ™ Ÿàÿ∂ÿπ€åÿ™ ÿ≥ÿ±Ÿàÿ±
php artisan ami:system status

# ÿ®ÿßÿ±⁄Ø€åÿ±€å ŸÖÿ¨ÿØÿØ ÿ™ŸÜÿ∏€åŸÖÿßÿ™
php artisan ami:system reload --module=sip
```

#### ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿßÿ≤ SystemManager Service

```php
use Shahkochaki\Ami\Services\SystemManager;

$systemManager = new SystemManager([
    'host' => 'localhost',
    'port' => 5038,
    'username' => 'admin',
    'secret' => 'amp111'
]);

// ÿÆÿßŸÖŸàÿ¥ ⁄©ÿ±ÿØŸÜ ÿ™ÿØÿ±€åÿ¨€å
$systemManager->shutdownServer(true, 'System maintenance');

// ÿ±€åÿ≥ÿ™ ŸÅŸàÿ±€å
$systemManager->restartServer(false, 'Emergency restart');

// ÿ®ÿßÿ±⁄Ø€åÿ±€å ŸÖÿ¨ÿØÿØ ÿ™ŸÜÿ∏€åŸÖÿßÿ™ SIP
$systemManager->reloadConfiguration('sip');

// ÿØÿ±€åÿßŸÅÿ™ Ÿàÿ∂ÿπ€åÿ™ ⁄©ÿßŸÖŸÑ ÿ≥ÿ±Ÿàÿ±
$status = $systemManager->getServerStatus();

// ÿ®ÿ±ŸÜÿßŸÖŸá‚Äåÿ±€åÿ≤€å ÿ±€åÿ≥ÿ™ ÿ®ÿ±ÿß€å 30 ÿØŸÇ€åŸÇŸá ÿ¢€åŸÜÿØŸá
$schedule = $systemManager->scheduleRestart(30, true, 'Scheduled maintenance');
```

#### ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿßÿ≤ Facade

```php
use Shahkochaki\Ami\Facades\SystemManager;

// ÿÆÿßŸÖŸàÿ¥ ⁄©ÿ±ÿØŸÜ ÿ™ÿØÿ±€åÿ¨€å
SystemManager::shutdownServer(true, 'Scheduled maintenance');

// ÿ±€åÿ≥ÿ™ ÿßÿ∂ÿ∑ÿ±ÿßÿ±€å
SystemManager::emergencyRestart();

// ÿØÿ±€åÿßŸÅÿ™ ⁄©ÿßŸÜÿßŸÑ‚ÄåŸáÿß€å ŸÅÿπÿßŸÑ
$channels = SystemManager::getActiveChannels();

// ŸÜÿ∏ÿßÿ±ÿ™ ÿ®ÿ± ŸÖŸÜÿßÿ®ÿπ ÿ≥€åÿ≥ÿ™ŸÖ
$resources = SystemManager::getSystemResources();
```

#### ÿπŸÖŸÑ€åÿßÿ™ ÿ®ÿ±ŸÜÿßŸÖŸá‚Äåÿ±€åÿ≤€å ÿ¥ÿØŸá ÿ®ÿß Queue

```php
use Shahkochaki\Ami\Jobs\SystemManagementJob;

// ÿ®ÿ±ŸÜÿßŸÖŸá‚Äåÿ±€åÿ≤€å ÿ±€åÿ≥ÿ™ ÿ®ÿ±ÿß€å 1 ÿ≥ÿßÿπÿ™ ÿ¢€åŸÜÿØŸá
SystemManagementJob::scheduleRestart(60, true, 'Nightly maintenance');

// ÿ®ÿ±ŸÜÿßŸÖŸá‚Äåÿ±€åÿ≤€å ÿÆÿßŸÖŸàÿ¥ ⁄©ÿ±ÿØŸÜ ÿ®ÿ±ÿß€å 2 ÿ≥ÿßÿπÿ™ ÿ¢€åŸÜÿØŸá
SystemManagementJob::scheduleShutdown(120, true, 'End of business hours');

// ÿ®ÿ±ŸÜÿßŸÖŸá‚Äåÿ±€åÿ≤€å ÿ®ÿßÿ±⁄Ø€åÿ±€å ŸÖÿ¨ÿØÿØ ÿ™ŸÜÿ∏€åŸÖÿßÿ™
SystemManagementJob::scheduleReload(30, 'dialplan');
```

## üìö ŸÖÿ´ÿßŸÑ‚ÄåŸáÿß€å Ÿæ€åÿ¥ÿ±ŸÅÿ™Ÿá / Advanced Examples

### ŸÖÿØ€åÿ±€åÿ™ ÿ±Ÿà€åÿØÿßÿØŸáÿß

```php
// ÿØÿ± €å⁄© Service Provider €åÿß Event Listener
use Illuminate\Support\Facades\Event;

Event::listen('ami.event.dial', function ($event) {
    Log::info('New call started', [
        'caller' => $event['CallerIDNum'],
        'destination' => $event['Destination']
    ]);
});

Event::listen('ami.event.hangup', function ($event) {
    Log::info('Call ended', [
        'channel' => $event['Channel'],
        'cause' => $event['Cause']
    ]);
});
```

### ÿß€åÿ¨ÿßÿØ ⁄©ŸÑÿßÿ≥ ÿ≥ŸÅÿßÿ±ÿ¥€å ÿ®ÿ±ÿß€å ŸÖÿØ€åÿ±€åÿ™ ÿ™ŸÖÿßÿ≥‚ÄåŸáÿß

```php
<?php

namespace App\Services;

use Illuminate\Support\Facades\Artisan;

class CallManager
{
    public function makeCall($from, $to, $context = 'default')
    {
        return Artisan::call('ami:action', [
            'action' => 'Originate',
            '--arguments' => [
                'Channel' => "SIP/{$from}",
                'Context' => $context,
                'Exten' => $to,
                'Priority' => '1',
                'CallerID' => $from
            ]
        ]);
    }

    public function hangupCall($channel)
    {
        return Artisan::call('ami:action', [
            'action' => 'Hangup',
            '--arguments' => [
                'Channel' => $channel
            ]
        ]);
    }

    public function getChannelStatus()
    {
        return Artisan::call('ami:action', [
            'action' => 'Status'
        ]);
    }
}
```

### ÿ≥ÿ±Ÿà€åÿ≥ ÿßÿ±ÿ≥ÿßŸÑ SMS ÿßŸÜÿ®ŸàŸá

```php
<?php

namespace App\Services;

use Illuminate\Support\Facades\Artisan;
use Illuminate\Support\Collection;

class BulkSmsService
{
    protected $device;

    public function __construct($device = null)
    {
        $this->device = $device ?: config('ami.dongle.sms.device');
    }

    public function sendBulkSms(Collection $recipients, string $message)
    {
        $results = [];

        foreach ($recipients as $number) {
            try {
                $result = Artisan::call('ami:dongle:sms', [
                    'number' => $number,
                    'message' => $message,
                    'device' => $this->device,
                    '--pdu' => strlen($message) > 160
                ]);

                $results[$number] = ['status' => 'success', 'result' => $result];

                // ÿ™ÿ£ÿÆ€åÿ± ⁄©Ÿàÿ™ÿßŸá ÿ®€åŸÜ ÿßÿ±ÿ≥ÿßŸÑ Ÿæ€åÿßŸÖ‚ÄåŸáÿß
                usleep(500000); // 0.5 second

            } catch (\Exception $e) {
                $results[$number] = ['status' => 'error', 'message' => $e->getMessage()];
            }
        }

        return $results;
    }
}
```

### ÿ≥ÿ±Ÿà€åÿ≥ ŸÖÿØ€åÿ±€åÿ™ ÿ≥€åÿ≥ÿ™ŸÖ Ÿæ€åÿ¥ÿ±ŸÅÿ™Ÿá

```php
<?php

namespace App\Services;

use Shahkochaki\Ami\Services\SystemManager;
use Illuminate\Support\Facades\Log;

class AdvancedSystemManager
{
    protected $systemManager;

    public function __construct()
    {
        $this->systemManager = new SystemManager();
    }

    /**
     * ÿ®ÿ±ÿ±ÿ≥€å ÿ≥ŸÑÿßŸÖÿ™ ÿ≥€åÿ≥ÿ™ŸÖ Ÿà ÿßŸÇÿØÿßŸÖ ÿØÿ± ÿµŸàÿ±ÿ™ ŸÜ€åÿßÿ≤
     */
    public function performHealthCheck()
    {
        $status = $this->systemManager->getServerStatus();
        $resources = $this->systemManager->getSystemResources();
        $channels = $this->systemManager->getActiveChannels();

        $issues = [];

        // ÿ®ÿ±ÿ±ÿ≥€å ÿÆÿ∑ÿßŸáÿß
        if (isset($status['error'])) {
            $issues[] = 'Server status error: ' . $status['error'];
        }

        // ÿ®ÿ±ÿ±ÿ≥€å ŸÖÿµÿ±ŸÅ ÿ®ÿßŸÑÿß€å ⁄©ÿßŸÜÿßŸÑ‚ÄåŸáÿß
        $channelCount = is_array($channels) ? count($channels) : 0;
        if ($channelCount > 100) {
            $issues[] = "High channel usage: {$channelCount} active channels";
        }

        // ŸÑÿß⁄Ø ŸÖÿ¥⁄©ŸÑÿßÿ™
        if (!empty($issues)) {
            Log::warning('System health issues detected', $issues);

            // ÿßÿ±ÿ≥ÿßŸÑ ÿßÿπŸÑÿßŸÜ €åÿß ÿßŸÇÿØÿßŸÖ ÿÆŸàÿØ⁄©ÿßÿ±
            $this->handleHealthIssues($issues);
        }

        return [
            'healthy' => empty($issues),
            'issues' => $issues,
            'channel_count' => $channelCount,
            'timestamp' => now()
        ];
    }

    /**
     * ÿÆÿßŸÖŸàÿ¥ ⁄©ÿ±ÿØŸÜ ÿßŸÖŸÜ ÿ®ÿß ÿ®ÿ±ÿ±ÿ≥€å ÿ¥ÿ±ÿß€åÿ∑
     */
    public function safeShutdown($reason = 'System maintenance')
    {
        // ÿ®ÿ±ÿ±ÿ≥€å ⁄©ÿßŸÜÿßŸÑ‚ÄåŸáÿß€å ŸÅÿπÿßŸÑ
        $channels = $this->systemManager->getActiveChannels();

        if (empty($channels)) {
            Log::info('No active calls, proceeding with immediate shutdown');
            return $this->systemManager->shutdownServer(false, $reason);
        } else {
            Log::info('Active calls detected, using graceful shutdown', [
                'active_channels' => count($channels)
            ]);
            return $this->systemManager->shutdownServer(true, $reason);
        }
    }

    /**
     * ŸÖÿØ€åÿ±€åÿ™ ŸÖÿ¥⁄©ŸÑÿßÿ™ ÿ≥ŸÑÿßŸÖÿ™ ÿ≥€åÿ≥ÿ™ŸÖ
     */
    protected function handleHealthIssues(array $issues)
    {
        foreach ($issues as $issue) {
            if (str_contains($issue, 'High channel usage')) {
                // ÿßŸÇÿØÿßŸÖ ÿ®ÿ±ÿß€å ⁄©ÿßŸáÿ¥ ÿ®ÿßÿ±
                Log::warning('Implementing load reduction measures');
                // ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ ÿß€åŸÜÿ¨ÿß ÿßŸÇÿØÿßŸÖÿßÿ™ ÿÆÿßÿµ€å ÿßŸÜÿ¨ÿßŸÖ ÿØŸá€åÿØ
            }
        }
    }
}
```

## üîç ÿ±Ÿà€åÿØÿßÿØŸáÿß€å Ÿæÿ¥ÿ™€åÿ®ÿßŸÜ€å ÿ¥ÿØŸá / Supported Events

⁄©ÿ™ÿßÿ®ÿÆÿßŸÜŸá ÿßÿ≤ ÿ™ŸÖÿßŸÖ ÿ±Ÿà€åÿØÿßÿØŸáÿß€å ÿßÿ≥ÿ™ÿßŸÜÿØÿßÿ±ÿØ Asterisk Ÿæÿ¥ÿ™€åÿ®ÿßŸÜ€å ŸÖ€å‚Äå⁄©ŸÜÿØ:

- **Call Events**: `Dial`, `Hangup`, `NewChannel`, `Bridge`
- **Agent Events**: `AgentConnect`, `AgentComplete`, `AgentLogin`, `AgentLogoff`
- **Queue Events**: `QueueMember`, `QueueParams`, `QueueSummary`
- **Dongle Events**: `DongleDeviceEntry`, `DongleSMSStatus`, `DongleUSSDStatus`
- **System Events**: `Reload`, `Shutdown`, `PeerStatus`
- **Management Events**: `ami.system.operation.sent`, `ami.system.operation.completed`

## üêõ ÿπ€åÿ®‚Äå€åÿßÿ®€å / Troubleshooting

### ŸÖÿ¥⁄©ŸÑÿßÿ™ ÿ±ÿß€åÿ¨

1. **ÿÆÿ∑ÿß€å ÿßÿ™ÿµÿßŸÑ**:

   ```
   Connection refused
   ```

   - ÿ®ÿ±ÿ±ÿ≥€å ⁄©ŸÜ€åÿØ ⁄©Ÿá Asterisk ÿØÿ± ÿ≠ÿßŸÑ ÿßÿ¨ÿ±ÿß ÿ®ÿßÿ¥ÿØ
   - ŸæŸàÿ±ÿ™ 5038 ÿ®ÿßÿ≤ ÿ®ÿßÿ¥ÿØ
   - ÿ™ŸÜÿ∏€åŸÖÿßÿ™ ŸÅÿß€åÿ±ŸàÿßŸÑ

2. **ÿÆÿ∑ÿß€å ÿßÿ≠ÿ±ÿßÿ≤ ŸáŸà€åÿ™**:

   ```
   Authentication failed
   ```

   - ŸÜÿßŸÖ ⁄©ÿßÿ±ÿ®ÿ±€å Ÿà ÿ±ŸÖÿ≤ ÿπÿ®Ÿàÿ± ÿ±ÿß ÿ®ÿ±ÿ±ÿ≥€å ⁄©ŸÜ€åÿØ
   - ÿØÿ≥ÿ™ÿ±ÿ≥€å‚ÄåŸáÿß€å ⁄©ÿßÿ±ÿ®ÿ± AMI ÿ±ÿß ÿ®ÿ±ÿ±ÿ≥€å ⁄©ŸÜ€åÿØ

3. **ŸÖÿ¥⁄©ŸÑ ÿßÿ±ÿ≥ÿßŸÑ SMS**:
   ```
   Device not found
   ```
   - Ÿàÿ∂ÿπ€åÿ™ Chan Dongle ÿ±ÿß ÿ®ÿ±ÿ±ÿ≥€å ⁄©ŸÜ€åÿØ: `dongle show devices`
   - ŸÜÿßŸÖ ÿØÿ≥ÿ™⁄ØÿßŸá ÿ±ÿß ÿØÿ±ÿ≥ÿ™ Ÿàÿßÿ±ÿØ ⁄©ÿ±ÿØŸá‚Äåÿß€åÿØ

### ŸÑÿß⁄Ø‚ÄåŸáÿß

ÿ®ÿ±ÿß€å ŸÅÿπÿßŸÑ‚Äåÿ≥ÿßÿ≤€å ŸÑÿß⁄Ø‚ÄåŸáÿß€å ÿ™ŸÅÿµ€åŸÑ€å:

```bash
php artisan ami:listen --monitor
```

### ÿ™ÿ≥ÿ™ ÿßÿ™ÿµÿßŸÑ

```bash
# ÿ™ÿ≥ÿ™ ÿ≥ÿßÿØŸá ÿßÿ™ÿµÿßŸÑ
php artisan ami:action Ping

# ÿ®ÿ±ÿ±ÿ≥€å Ÿàÿ∂ÿπ€åÿ™ ÿØÿ≥ÿ™⁄ØÿßŸá‚ÄåŸáÿß€å dongle
php artisan ami:action Command --arguments=Command:"dongle show devices"
```

## üîß ÿ™Ÿàÿ≥ÿπŸá / Development

### ÿßÿ¨ÿ±ÿß€å ÿ™ÿ≥ÿ™‚ÄåŸáÿß

```bash
composer test
```

### ÿßÿ≥ÿ™ÿßŸÜÿØÿßÿ±ÿØŸáÿß€å ⁄©ÿØ

```bash
composer phpcs
```

### ÿ≥ÿßÿÆÿ™ÿßÿ± Ÿæÿ±Ÿà⁄òŸá

```
src/
‚îú‚îÄ‚îÄ Commands/          # Artisan commands
‚îÇ   ‚îú‚îÄ‚îÄ AmiAbstract.php
‚îÇ   ‚îú‚îÄ‚îÄ AmiAction.php
‚îÇ   ‚îú‚îÄ‚îÄ AmiCli.php
‚îÇ   ‚îú‚îÄ‚îÄ AmiListen.php
‚îÇ   ‚îú‚îÄ‚îÄ AmiSms.php
‚îÇ   ‚îú‚îÄ‚îÄ AmiUssd.php
‚îÇ   ‚îî‚îÄ‚îÄ AmiSystemControl.php   # NEW: System management command
‚îú‚îÄ‚îÄ Services/          # Service classes
‚îÇ   ‚îú‚îÄ‚îÄ BulkSmsService.php
‚îÇ   ‚îú‚îÄ‚îÄ CallManager.php
‚îÇ   ‚îî‚îÄ‚îÄ SystemManager.php      # NEW: System management service
‚îú‚îÄ‚îÄ Jobs/              # Queue jobs
‚îÇ   ‚îú‚îÄ‚îÄ BulkSmsJob.php
‚îÇ   ‚îî‚îÄ‚îÄ SystemManagementJob.php # NEW: Scheduled system operations
‚îú‚îÄ‚îÄ Facades/           # Laravel facades
‚îÇ   ‚îú‚îÄ‚îÄ Ami.php
‚îÇ   ‚îî‚îÄ‚îÄ SystemManager.php      # NEW: System management facade
‚îú‚îÄ‚îÄ Providers/         # Service providers
‚îÇ   ‚îî‚îÄ‚îÄ AmiServiceProvider.php
‚îú‚îÄ‚îÄ Factory.php        # AMI connection factory
‚îî‚îÄ‚îÄ Parser.php         # AMI protocol parser

config/
‚îî‚îÄ‚îÄ ami.php           # Configuration file

docs/                 # Documentation
‚îú‚îÄ‚îÄ SYSTEM_MANAGEMENT.md    # NEW: System management guide
‚îî‚îÄ‚îÄ ...

examples/             # Usage examples
‚îú‚îÄ‚îÄ system_management_examples.php  # NEW: System management examples
‚îî‚îÄ‚îÄ ...

tests/                # Test files
‚îî‚îÄ‚îÄ ...
```

## ü§ù ŸÖÿ¥ÿßÿ±⁄©ÿ™ / Contributing

ÿßÿ≤ ŸÖÿ¥ÿßÿ±⁄©ÿ™ ÿ¥ŸÖÿß ÿßÿ≥ÿ™ŸÇÿ®ÿßŸÑ ŸÖ€å‚Äå⁄©ŸÜ€åŸÖ! ŸÑÿ∑ŸÅÿßŸã:

1. Fork ⁄©ŸÜ€åÿØ
2. €å⁄© branch ÿ¨ÿØ€åÿØ ÿß€åÿ¨ÿßÿØ ⁄©ŸÜ€åÿØ (`git checkout -b feature/amazing-feature`)
3. ÿ™ÿ∫€å€åÿ±ÿßÿ™ ÿ±ÿß commit ⁄©ŸÜ€åÿØ (`git commit -m 'Add amazing feature'`)
4. ÿ®Ÿá branch ÿÆŸàÿØ push ⁄©ŸÜ€åÿØ (`git push origin feature/amazing-feature`)
5. €å⁄© Pull Request ÿß€åÿ¨ÿßÿØ ⁄©ŸÜ€åÿØ

### ÿ±ÿßŸáŸÜŸÖÿß€å ÿ™Ÿàÿ≥ÿπŸá

- ÿßÿ≤ PSR-4 autoloading ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ
- ÿ™ÿ≥ÿ™‚ÄåŸáÿß ÿ±ÿß ÿßÿ¨ÿ±ÿß ⁄©ŸÜ€åÿØ ŸÇÿ®ŸÑ ÿßÿ≤ commit
- PHPDoc ŸÖŸÜÿßÿ≥ÿ® ÿßÿ∂ÿßŸÅŸá ⁄©ŸÜ€åÿØ
- ÿßÿ≤ ÿßÿ≥ÿ™ÿßŸÜÿØÿßÿ±ÿØŸáÿß€å Laravel Ÿæ€åÿ±Ÿà€å ⁄©ŸÜ€åÿØ

## üìÑ ŸÖÿ¨Ÿàÿ≤ / License

ÿß€åŸÜ Ÿæÿ±Ÿà⁄òŸá ÿ™ÿ≠ÿ™ ŸÖÿ¨Ÿàÿ≤ [MIT License](LICENSE.md) ŸÖŸÜÿ™ÿ¥ÿ± ÿ¥ÿØŸá ÿßÿ≥ÿ™.

## üë®‚Äçüíª ÿ≥ÿßÿ≤ŸÜÿØŸá / Author

**Ali Shahkochaki**

- Website: [shahkochaki.ir](https://shahkochaki.ir)
- Email: ali.shahkochaki7@gmail.com
- GitHub: [@shahkochaki](https://github.com/shahkochaki)

## üôè ÿ™ÿ¥⁄©ÿ± / Acknowledgments

- [ReactPHP](https://reactphp.org/) ÿ®ÿ±ÿß€å event loop
- [clue/ami-react](https://github.com/clue/reactphp-ami) ÿ®ÿ±ÿß€å AMI protocol
- ÿ¨ÿßŸÖÿπŸá Laravel ÿ®ÿ±ÿß€å ŸÅÿ±€åŸÖŸàÿ±⁄© ÿπÿßŸÑ€å

## üìö ŸÖŸÜÿßÿ®ÿπ ŸÖŸÅ€åÿØ / Useful Resources

- [Asterisk Manager Interface](https://wiki.asterisk.org/wiki/display/AST/The+Asterisk+Manager+TCP+IP+API)
- [Chan Dongle Documentation](https://github.com/bg111/asterisk-chan-dongle)
- [Issabel Documentation](https://www.issabel.org/documentation/)
- [System Management Guide](docs/SYSTEM_MANAGEMENT.md) - ÿ±ÿßŸáŸÜŸÖÿß€å ⁄©ÿßŸÖŸÑ ŸÖÿØ€åÿ±€åÿ™ ÿ≥€åÿ≥ÿ™ŸÖ
- [System Management Examples](examples/system_management_examples.php) - ŸÖÿ´ÿßŸÑ‚ÄåŸáÿß€å ÿπŸÖŸÑ€å
- [Troubleshooting Guide](docs/TROUBLESHOOTING.md) - ÿ±ÿßŸáŸÜŸÖÿß€å ÿπ€åÿ®‚Äå€åÿßÿ®€å Ÿà ÿ≠ŸÑ ŸÖÿ¥⁄©ŸÑÿßÿ™

## üÜï ÿ™ÿ∫€å€åÿ±ÿßÿ™ ŸÜÿ≥ÿÆŸá ÿ¨ÿØ€åÿØ / What's New

### ŸÜÿ≥ÿÆŸá 2.1+ - ŸÖÿØ€åÿ±€åÿ™ ÿ≥€åÿ≥ÿ™ŸÖ

- ‚úÖ **SystemManager Service**: ⁄©ŸÜÿ™ÿ±ŸÑ ⁄©ÿßŸÖŸÑ ÿ≥ÿ±Ÿàÿ± Asterisk/Issabel
- ‚úÖ **System Commands**: ÿØÿ≥ÿ™Ÿàÿ±ÿßÿ™ CLI ÿ®ÿ±ÿß€å ŸÖÿØ€åÿ±€åÿ™ ÿ≥€åÿ≥ÿ™ŸÖ
- ‚úÖ **Scheduled Operations**: ÿπŸÖŸÑ€åÿßÿ™ ÿ®ÿ±ŸÜÿßŸÖŸá‚Äåÿ±€åÿ≤€å ÿ¥ÿØŸá ÿ®ÿß Queue
- ‚úÖ **Health Monitoring**: ŸÜÿ∏ÿßÿ±ÿ™ ÿ®ÿ± ÿ≥ŸÑÿßŸÖÿ™ ÿ≥€åÿ≥ÿ™ŸÖ
- ‚úÖ **Safe Operations**: ÿπŸÖŸÑ€åÿßÿ™ ÿßŸÖŸÜ ÿ®ÿß ÿ®ÿ±ÿ±ÿ≥€å ÿ¥ÿ±ÿß€åÿ∑
- ‚úÖ **Event Integration**: ÿßÿØÿ∫ÿßŸÖ ÿ®ÿß ÿ≥€åÿ≥ÿ™ŸÖ ÿ±Ÿà€åÿØÿßÿØ Laravel

### ÿßŸÖ⁄©ÿßŸÜÿßÿ™ ÿ¨ÿØ€åÿØ:

```php
// ÿÆÿßŸÖŸàÿ¥ ⁄©ÿ±ÿØŸÜ Ÿà ÿ±€åÿ≥ÿ™ ÿ≥ÿ±Ÿàÿ±
SystemManager::shutdownServer(true, 'Maintenance');
SystemManager::restartServer(false, 'Emergency');

// ŸÜÿ∏ÿßÿ±ÿ™ ÿ®ÿ± ÿ≥€åÿ≥ÿ™ŸÖ
$status = SystemManager::getServerStatus();
$resources = SystemManager::getSystemResources();

// ÿπŸÖŸÑ€åÿßÿ™ ÿ®ÿ±ŸÜÿßŸÖŸá‚Äåÿ±€åÿ≤€å ÿ¥ÿØŸá
SystemManagementJob::scheduleRestart(60, true, 'Nightly restart');
```

### ÿØÿ≥ÿ™Ÿàÿ±ÿßÿ™ ÿ¨ÿØ€åÿØ CLI:

```bash
php artisan ami:system shutdown --graceful
php artisan ami:system restart --force
php artisan ami:system reload --module=sip
php artisan ami:system status
```

---

‚≠ê ÿß⁄Øÿ± ÿß€åŸÜ Ÿæÿ±Ÿà⁄òŸá ÿ®ÿ±ÿß€åÿ™ÿßŸÜ ŸÖŸÅ€åÿØ ÿ®ŸàÿØÿå ŸÑÿ∑ŸÅÿßŸã ÿ≥ÿ™ÿßÿ±Ÿá ÿ®ÿØŸá€åÿØ!

**Made with ‚ù§Ô∏è for Iranian developers**
